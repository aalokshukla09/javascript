// console.log("Hello World Start");

// const p1 = fetch("https://api.github.com/users");

// // Promise -> pending -> fulfilled / rejected

// const p2 = p1.then((response)=>{
//    return response.json();
// })


// p2.then((data)=>{
//     console.log(data);
// })

// Promise Chaining 

// fetch("https://api.github.com/users")
// .then((response)=>{
//     if(!response.ok){
//         throw new Error("Data is not persent in server");
//     }
//    return response.json();
// })
// .then((data)=>{
//     console.log(data[0]);
// })
// .catch((error)=>{
//     console.log("Error is: ", error);
// });

// // catch -> to handle error in promise chaining

// console.log("Hello World End");


// Callbacks -> Callback Hell -> Promises -> Async/Await

// json vs js object -> JSON.parse() , JSON.stringify()

// JS Object → JSON (Stringify)
// const obj = { name: "Aalok", age: 22 };
// const json = JSON.stringify(obj);

// console.log(json);
// // '{"name":"Aalok","age":22}'


// JSON (string) → JS Object (Parse)
// const jsonString = '{"name":"Aalok","age":22}';
// const jsObject = JSON.parse(jsonString);
// console.log(jsObject);
// // { name: 'Aalok', age: 22 }

// const j1 = {
//     name: "Rohit",
//     age: 30,
//     address: "dwarka",
// }


// // convert to json

// const json = JSON.stringify(j1);

// console.log(json);


// const jsonFormat = `{
//     "name":"Rohit",
//     "age": 30,
//     "address": "dwarka"
// }`;


// // java script object

// const JsObject = JSON.parse(jsonFormat);

// console.log(JsObject);


// // Creating a Promise

// const p1 = new Promise((resolve,reject)=>{

//     resolve({
//         name:"Rohit",
//         age:30,
//     });
//     // reject("Error: Something went wrong");
// })

// p1.then((response)=>{
//     console.log(response);
// }).catch((error)=>{
//     console.log(error);
// })

// Solution of Callback Hell using Promises

const orderDetail = {
    orderId: 123123,
    food:["Pizza","biryani","coke"],
    cost: 620,
    customer_name: "Rohit",
    customer_location: "Dwarka",
    restaurant_location: "Delhi"
}

function placedOrder(orderDetail){
    console.log(`${orderDetail.cost} Payment is in progress`);
    
    return new Promise((resolve,reject)=>{
       setTimeout(()=>{
     
      if(Math.random()>0.1){
      console.log("Payment is received and order get placed");
      orderDetail.status = true;
       resolve(orderDetail);
      }
      else{
        reject("Payment is failed");
      }

    },3000)
    })
   
}



function preparingOrder(orderDetail){
    console.log(`Your food preparation started of ${orderDetail.food}`);
    
    return new Promise((resolve,reject)=>{
  
     setTimeout(()=>{

        if(Math.random()>0.05){ 
        console.log("Your order is now prepared");
        orderDetail.token = 123;
        resolve(orderDetail);
        }
        else{
            reject("Food item is not persent at restaurant");
        }
        
    },3000);
    })
    
}


function pickupOrder(orderDetail){
    console.log(`Delivery boy is on way to pickup order from ${orderDetail.restaurant_location} `);
    
    return new Promise((resolve,reject)=>{


        setTimeout(()=>{
         if(Math.random()>0.05){   
        console.log("I have picked up the order");
        orderDetail.received = true;
        resolve(orderDetail);
        }
        else{
           reject("Delivery boy Unable to reach restaurant")
        }
    },3000);
    })
    
}


function deliverOrder(orderDetail){
    console.log(`I am on my way to deliver order ${orderDetail.customer_location}`);
    
    return new Promise((resolve,reject)=>{
       setTimeout(()=>{
        console.log("Order delivered succesfully");
        orderDetail.delivery = true;
        resolve(orderDetail);
    },3000)
    })
    
}


placedOrder(orderDetail)
.then((orderDetail)=>preparingOrder(orderDetail))
.then((orderDetail)=>pickupOrder(orderDetail))
.then((orderDetail)=>deliverOrder(orderDetail))
.then((orderDetail)=>{
    console.log(orderDetail);
})
.catch((error)=>{
    console.log("Error: ", error);
}).
finally(()=>{
    console.log("I am doing cleanup");
})

